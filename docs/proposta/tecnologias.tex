\subsection{Tecnologias para desenvolvimento de uma solução própria}
Discutir soluções de integração de aplicações 
sem fazer referência ao conceito de 
arquitetura orientada a serviços ({\em Service-Oriented Architecture}, ou SOA)
é, hoje, praticamente impossível.
Apesar de não ser um conceito realmente novo, 
os benefícios obtidos pela adoção dos princípios de SOA para
a integração de aplicações em ambientes heterogêneos
são cada vez mais reconhecidos no mercado,
tornando essa arquitetura um padrão de referência
para a implementação de soluções de integração.

Numa arquitetura SOA, aplicações compartilham dados e funcionalidades
sob a forma de serviços e interagem atuando como consumidores e/ou
provedores desses serviços. 
A principal característica desse tipo de arquitetura é o baixo grau de 
acoplamento entre provedores e consumidores de serviços.
Para atendê-la, os serviços oferecidos devem ser descritos através de uma
linguagem independente de plataforma e linguagem de programação,
isolando o consumidor de um serviço dos detalhes específicos
de sua implementação. 
Esse tipo de descrição ``neutra''\  permite, por exemplo, que consumidores e
provedores de serviço sejam desenvolvidos em linguagens diferentes,
e executem sob diversas plataformas.
Além disso, a disponibilização de um serviço de registro, ou diretório,
permite que servidores publiquem suas ofertas de serviço, 
e que consumidores desses serviços possam pesquisá-las,
conhecer seus detalhes
e interagir com os serviços,
sem conhecer, de antemão, a identidade ou localização de seus provedores.
Essa relação dinâmica entre provedores e consumidores
de serviço, ilustrada na Figura~\ref{figsoa},
confere ao ambiente um alto grau de reuso, extensibilidade, 
e de adaptação a mudanças.
\begin{figure}
\center
\includegraphics*{figs/figsoa.jpg}
\caption{Arquitetura orientada a serviços}
\label{figsoa}
\end{figure}

A implementação de uma arquitetura SOA não pressupõe o uso de uma
tecnologia específica;
qualquer tecnologia ou infraestrutura que dê suporte à descoberta 
dinâmica de serviços e à descrição desses serviços
com base em interfaces bem definidas e independentes de implementação
pode ser utilizada.
Contudo, a adoção de padrões abertos para a descrição e publicação
de serviços e para a interação entre consumidores e provedores de
serviços é fundamental para garantir a interoperabilidade em 
ambientes heterogêneos e a independência de fornecedores de tecnologias.
Nesse sentido, tanto serviços WEB 
como a própria arquitetura CORBA, tecnologias baseadas em padrões abertos, 
independentes de fornecedor e de ampla aceitação no mercado, 
são opções a serem consideradas para a implementação de uma solução 
de integração multi-plataforma.
Uma outra opção a ser considerada é Java Business Integration (JBI),
um padrão para a implementação de uma arquitetura SOA
recentemente proposto pela Sun à comunidade Java.

\subsubsection{Serviços WEB}
Serviços WEB \cite{Newcomer2002} são, basicamente, envelopes
({\em wrappers})\  XML que encapsulam diversos tipos de sistemas de
software (objetos distribuídos, sistemas de bancos de dados,
aplicações WEB, aplicações convencionais),
oferecendo formas  padronizadas para acesso aos dados e outras 
funcionalidades desses sistemas. 
O acesso a um serviço WEB é realizado através do envio de mensagens
de requisição de serviço representadas por documentos XML;
é responsabilidade da implementação da interface de um serviço WEB
transformar essas mensagens XML para o formato apropriado
à invocação do sistema ou componente encapsulado e, quando for o caso,
criar a mensagem XML correspondente à resposta de uma requisição.

A tecnologia básica para a construção de serviços WEB é, portanto, XML 
--- a linguagem é utilizada para descrever 
todo o tipo de dado, ou informação, envolvido na interação com esses serviços.
Além de XML, uma infraestrutura de integração baseada em serviços WEB envolve 
as seguintes tecnologias relacionadas:
\begin{itemize}
\item WSDL (Web Services Description Language)

É a linguagem utilizada para descrever a interface oferecida por um serviço WEB.
Essa descrição define os tipos de dados trocados entre consumidores e serviços, 
as operações realizadas sobre esses dados e os mapeamentos ({\em bindings}) para os
protocolos utilizados no transporte das mensagens.

De forma geral, o mapeamento das funcionalidades de um determinado 
sistema para uma interface de serviço WSDL não é uma tarefa trivial;
a descrição WSDL de um serviço é significativamente mais complexa que a interface 
``nativa'' desse serviço.
Tipicamente, fornecedores de sistemas de banco de dados,
de infraestruturas de {\em middleware},
e de infraestruturas de integração baseadas em serviços WEB provêem ferramentas que
automatizam tanto a geração das descrições de serviço WSDL como também a
geração das implementações dessas interfaces (i.e, o mapeamento das interações
descritas pela interface WSDL para as invocações do componente encapsulado
pelo serviço WEB).

\item SOAP (Simple Object Access Protocol)

É o protocolo utilizado para a troca de mensagens entre consumidores e 
serviços WEB.
Mensagens SOAP são documentos XML transportadas geralmente em requisições e 
respostas HTTP; contudo, a definição do protocolo SOAP admite o uso de outros tipos de 
transporte.

\item UDDI (Universal Description, Discovery and Integration)

É o serviço de registro utilizado para a publicação dos serviços WEB oferecidos
em um ambiente de integração. 
A especificação do {\em framework} UDDI define um modelo de dados em XML
para o armazenamento de informações sobre serviços --- incluindo
a localização de sua descrição em WSDL ---
e APIs SOAP para a publicação e consulta dessas informações.
\end{itemize}

A tecnologia de serviços WEB dá suporte a dois padrões básicos de 
interação:
baseada em chamada remota de procedimentos (RPC) e orientada a documento.
Numa interação baseada em RPC,
a mensagem XML enviada pelo consumidor de um serviço 
representa uma chamada de método
associada a parâmetros de entrada e saída,
e produz uma resposta síncrona para esse consumidor.
Esse tipo de interação é geralmente observado quando 
sistemas de objetos distribuídos
(como CORBA ou J2EE) ou outros tipos de sistemas com interfaces ``nativas''
baseadas em RPC
têm suas interfaces mapeadas diretamente para interfaces WSDL.
Esse mapeamento, contudo, não expõe toda a funcionalidade provida 
por um sistema de objetos distribuídos \cite{Vinoski2002, Vogels2003}.
A tecnologia de serviços WEB, por exemplo, não inclui
a noção de referências a objetos,
essencial a padrões de interação que requeiram a manutenção
de estado entre requisições de serviço.
Apesar de ser possível expor objetos como serviços
WEB, representando-os através de URIs
({\em Universal Resource Identifiers}),
requisitos mais rígidos de escalabilidade e desempenho podem inviabilizar esse tipo de solução. 

No padrão orientado a documento, a interação entre um consumidor e um
serviço é assíncrona;
requisições de serviço são mensagens XML auto-contidas e não envolvem
uma resposta imediata ao consumidor.
Esse tipo de interação é similar ao implementado, por exemplo, 
por sistemas de mensageria ({\em message-based systems}), 
e favorece um nível de integração de granularidade 
significativamente mais alto que o anterior.

A adoção da tecnologia de serviços WEB 
pode não ser adequada em alguns cenários de integração,
como o compartilhamento de dados de grande volume ---
dados sísmicos, por exemplo.
A representação desses dados em XML impõe uma sobrecarga
relevante de processamento a consumidores e provedores
de dados,
além de um alto consumo da banda de comunicação,
o que pode prejudicar o desempenho das aplicações e do ambiente
de integração como um todo.
Além disso, 
dependendo do tamanho do dado acessado,
copiá-lo integralmente para clientes como
aplicações de visualização pode ser inviável.
Para atender esse tipo de cenário,
serviços de acesso a repositórios usualmente disponibilizam
fábricas de objetos que implementam diferentes métodos para o acesso
estruturado aos dados.
Acessando esses objetos, o consumidor poder obter segmentos, 
ou porções, do dado, à medida que forem necessários.
Conforme discutimos anteriormente, essa funcionalidade dificilmente é 
mapeada para interfaces de serviços WEB.

De forma geral, a tecnologia de serviços WEB é mais adequada 
a ambientes de alto nível de integração,
onde a interação entre consumidores e provedores de
serviços é inerentemente
assíncrona,
interfaces de serviço provêem funcionalidades complexas
e desempenho de comunicação não é um requisito essencial \cite{Vinoski20022}.
Essa propriedade não contempla
todas as características e requisitos para um ambiente de
integração de aplicações e dados do E\&P da Petrobras. 

\subsubsection{Java Business Integration}
Java Business Integration (JBI) \cite{JBI2005} é uma proposta
para uma arquitetura de uma infraestrutura de integração 
baseada em Java e em princípios de SOA. 
Essa arquitetura, ilustrada na Figura~\ref{figjbi}, consiste, basicamente,
de um {\em container} ({\em JBI Environment}) que hospeda componentes 
dinamicamente conectados a um roteador de mensagens 
({\em Normalized Message Router}).
Esses componentes atuam no ambiente JBI como provedores ou
consumidores de serviços, ou simultaneamente nos dois papéis. 
Dois tipos distintos de componentes são definidos:
\begin{itemize}
\item {\em Service Engines}

São componentes que provêem ou consomem serviços internamente ao
ambiente JBI. Esse tipo de componente é responsável pela 
integração de aplicações e sistemas implementados 
em Java
e de outros recursos acessíveis através de APIs dessa
linguagem, como, por exemplo, sistemas de banco de dados.
\item{\em Binding Components}

São componentes responsáveis pela integração 
de provedores e consumidores de serviços externos ao
ambiente JBI ---
aplicações ou sistemas implementados em 
outras linguagens, 
ou sobre outras plataformas.
Um {\em Binding Component} atua, basicamente,
como um representante do componente externo,
traduzindo os protocolos e formatos utilizados
na interface com esse componente para o padrão adotado
no ambiente JBI.

\end{itemize}

\begin{figure}
\center
\includegraphics*{figs/figjbi.jpg}
\caption{Arquitetura JBI}
\label{figjbi}
\end{figure}

Assim como em uma infraestrutura baseada em serviços WEB.
os componentes de um ambiente JBI interagem através de
um mecanismo de troca de mensagens baseado em XML,
e descrevem seus serviços através de interfaces WSDL.
A interface de um serviço compreende um conjunto de funções
--- operações WSDL --- que, dependendo do modelo de interação
especificado ({\em One-Way} ou {\em Request-Response}),
podem ou não produzir respostas síncronas ao consumidor do serviço.

A interação entre componentes JBI
é mediada por um roteador de mensagens
--- {\em Normalized Message Router} (NMR).
É esse roteador quem recebe as mensagens geradas por um consumidor
ou provedor de serviço e as direciona ao componente apropriado
ao seu processamento. 
Além de intermediar a troca de mensagens,
o NMR cumpre também o papel de serviço de registro;
é através dele que provedores de serviço
--- {\em Service Engines} e {\em Binding Components} ---
publicam suas interfaces WSDL e que consumidores 
obtém as informações necessárias para localizar
e interagir com esses serviços.

Além da infraestrutura de suporte à interação entre componentes,
o padrão JBI define também
mecanismos para a administração do ambiente de integração,
baseados em JMX ({\em Java Management Extensions}).
Esses mecanismos provêem suporte para a instalação de componentes,
para o controle de seu ciclo de vida e
para o gerenciamento do ambiente como um todo.

A arquitetura JBI é fortemente baseada na tecnologia de serviços WEB
e, como essa tecnologia, privilegia ambientes de um alto nível de integração,
mostrando-se inadequada para os mesmos cenários que discutimos
anteriormente: o compartilhamento de dados binários
e de grande volume e interações que requeiram suporte 
à manutenção de estado entre requisições de serviço.

Uma outra questão relevante é o foco da arquitetura JBI
na integração de aplicações e sistemas baseados em Java.
Atualmente, grande parte das aplicações e sistemas
utilizados na área de E\&P da Petrobras ---
tanto aplicações próprias como aplicações
de mercado --- é implementada em outras
linguagens.
A integração dessas aplicações a um ambiente JBI
requer a implementação de 
{\em Binding Components}, de mecanismos de acesso
para a comunicação entre as aplicações e esses componentes
e de mecanismos de tradução entre as interfaces internas
e externas ao ambiente JBI.

\subsubsection{Arquitetura CORBA}
\label{CORBA}
A arquitetura CORBA \cite{Bolton2002} foi criada, em meados da década de 90,
em resposta a uma demanda crescente por uma infraestrutura para o
desenvolvimento de aplicações distribuídas em ambientes heterogêneos.
Até o início dos anos 2000, o desenvolvimento e evolução de CORBA
recebeu um enorme suporte da indústria, refletido nas centenas de membros
da OMG --- a organização responsável pela especificações dos padrões
adotados para essa arquitetura.
Diversas implementações comerciais de CORBA foram oferecidas e utilizadas para
o desenvolvimento de aplicações e sistemas distribuídos em diferentes 
domínios, como comércio eletrônico, telecomunicações, aplicações bancárias
e científicas e sistemas de tempo real.
Implementações abertas, bastante completas e de qualidade --- como MICO
e JacORB --- também contribuíram fortemente para o sucesso dessa arquitetura. 

Nos últimos anos observa-se, porém, uma redução no 
uso de CORBA e o redirecionamento de parte do mercado para outras tecnologias.
Esse redirecionamento deve-se, em grande parte, a dois fatores
principais.
O primeiro deles é o uso crescente da linguagem Java e de suas
plataformas próprias para a construção de sistemas distribuídos,
como J2EE.
Entretanto,
plataformas centradas em uma linguagem não são
adequadas a ambientes predominantemente heterogêneos;
a integração de aplicações desenvolvidas
em outras linguagens requer a implementação de 
adaptadores, o que implica um maior esforço
de desenvolvimento e, usualmente, prejuízos de desempenho.

O segundo fator foi a introdução da tecnologia de serviços WEB
e sua identificação com os benefícios de SOA.
Apesar de sua adequação a alguns cenários de integração,
essa tecnologia, como discutimos anteriormente,
não oferece as mesmas características e funcionalidades de 
um sistema de objetos distribuídos, muitas delas necessárias
à implementação de uma infraestrutura de integração com
requisitos específicos, como é o caso da integração de
aplicações de E\&P.

CORBA é, basicamente, uma tecnologia de objetos distribuídos
cuja principal característica é a independência de plataforma e
linguagem de programação.
Essa independência é garantida através do uso de uma linguagem neutra (IDL)
para a descrição das interfaces de serviço oferecidas por um objeto
--- isto é, as operações disponibilizadas e os tipos de dados que representam
os parâmetros de entrada e saída definidos para essas operações.
Interfaces de serviço descritas em IDL são significativamente
mais claras e sucintas que interfaces WSDL, permitindo, por exemplo, uma
melhor compreensão das interações entre consumidores
e provedores de um determinado serviço.

O padrão CORBA define o mapeamento de IDL para 
as principais linguagens de programação utilizadas atualmente,
como C, C++, Java e Python, dentre outras.
Implementações de CORBA tipicamente oferecem compiladores que
traduzem interfaces IDL para linguagens específicas,
produzindo o código que permite que clientes e provedores
de serviço desenvolvidos nessas linguagens possam invocar e atender 
as operações definidas em IDL.
Como os mapeamentos de IDL são padronizados,
implementações de clientes e servidores independem do compilador
de um fornecedor específico, e podem ser portadas sem qualquer
alteração.

Para garantir a interoperabilidade entre diferentes implementações 
da arquitetura CORBA, o transporte de requisições de serviço e 
de suas respostas utiliza um protocolo padronizado pela OMG (IIOP).
A especificação desse protocolo define o formato das mensagens
trocadas, a representação dos dados transportados nessas mensagens,
e o mapeamento da comunicação sobre conexões TCP/IP% 
\footnote{IIOP é, na verdade, a especialização de um protocolo genérico (GIOP),
que não especifica um protocolo de transporte específico,
apenas um conjunto de requisitos, como o suporte a conexões bi-direcionais.}.
O projeto desse protocolo levou em consideração uma série de requisitos,
dentre eles Escalabilidade e desempenho.
Ao contrário de SOAP, por exemplo, que utiliza XML (uma representação 
textual), o protocolo IIOP utiliza uma representação mais adequada
ao transporte eficiente de diversos tipos de dados, inclusive dados
binários.  
Essa característica, aliada à disponibilidade de implementações de CORBA
de grande desempenho,
explica o sucesso e a predominância dessa arquitetura 
em domínios como sistemas de tempo real e sistemas embutidos.

Além da infraestrutura para suporte à interação entre
clientes e provedores de serviço, o padrão CORBA define também
uma série de serviços básicos, dentre eles um serviço de nomes
e um serviço de {\em trading}

A função básica do serviço de nomes é permitir que clientes de um 
serviço obtenham dinamicamente a localização --- isto é, a referência 
--- dos objetos que constituem os pontos de acesso a esse serviço.
Para prover essa funcionalidade, o serviço de nomes mantém um
repositório que armazena associações ({\em bindings}) entre nomes
e referências de objetos.
Provedores de serviços fornecem ao serviço de nomes essas associações;
clientes de serviços utilizam o serviço de nomes para
obter a localização do objeto associado a um determinado nome.

O serviço de {\em trading} oferece uma funcionalidade mais rica
para a descoberta de provedores de serviços, permitindo
a associação de características, ou propriedades,
às ofertas de um tipo de serviço (uma interface).
Ao exportar uma oferta de serviço, um provedor especifica,
além de sua interface e localização, valores para essas propriedades.
Através de consultas ao serviço de {\em trading}, consumidores
de um serviço podem obter a localização de um ou mais provedores que 
satisfaçam determinados critérios --- restrições ou condições quanto
aos valores das propriedades.

A especificação de interfaces de serviço em um linguagem neutra (IDL)
e a possibilidade de descoberta dinâmica de provedores de serviço,
seja através do serviço de nomes ou do serviço de {\em trading},
provêem o suporte necessário para a implementação de uma arquitetura
SOA baseada em CORBA.
CORBA
provê também todas as facilidades de uma tecnologia de 
objetos distribuídos: o suporte a referências a objetos,
à instanciação de objetos a partir de fábricas
e à manutenção de estado ao longo de interações entre consumidores
e provedores de serviço.
Essas características, aliadas a um transporte mais eficiente 
de dados binários e de grande volume,
permitem que uma infraestrutura baseada em CORBA
atenda aos requisitos necessários
à integração de aplicações de E\&P.

O padrão CORBA define também
dois serviços que provêem suporte à troca assíncrona de 
mensagens genéricas: o serviço de eventos e o serviço de 
notificações.
Esses serviços 
disponibilizam canais de comunicação que 
atuam como roteadores, intermediando a interação
entre geradores e consumidores de mensagens.
Geradores e receptores de mensagens são fortemente desacoplados.
Um gerador envia suas mensagens a um canal de comunicação, 
sem necessariamente conhecer a identidade ou localização de
possíveis consumidores.
Consumidores de mensagens, por sua vez, recebem mensagens 
de um canal sem necessariamente conhecer a identidade ou localização 
de seus geradores.
O estabelecimento de um canal de comunicação
não exige uma correspondência de um para
um entre geradores e consumidores de mensagens;
a conexão de múltiplos geradores e de múltiplos consumidores a
um mesmo canal de comunicação é permitida.

O serviço de notificações estende a funcionalidade básica do
serviço de eventos --- a troca assíncrona de mensagens genéricas ---
oferecendo algumas facilidades adicionais, como, por exemplo,
a definição de eventos estruturados,
a possibilidade de um consumidor especificar filtros para
restringir o tipo de eventos que deseja receber,
e a configuração de diversas  propriedades de qualidade
de serviço --- como garantia de entrega, prioridade e 
tempo de vida de mensagens.   

O suporte à troca de mensagens assíncronas entre aplicações
é uma funcionalidade importante para ambientes de integração.
Além de permitir, quando adequado, um maior desacoplamento
entre provedores e consumidores de serviço,
essa funcionalidade é essencial a aplicações que desejam
implementar facilidades de colaboração.
