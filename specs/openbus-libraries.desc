-- Description of tecmake oriented software, typical tecgraf programs that need
-- tecmake and tecgraf variables to be compiled. Some dummy packages could
-- also use it, like packages that just need to copy files and make links.
-- ATTENTION: place the fundamental packages first!
-- If A depends on B then you should place B's description before than A's.
SUNOS64_TECMAKE_FLAGS="USE_NODEPEND=Yes TEC_UNAME=SunOS510_64 BUILD_64=yes"

IDL_VERSION="v2_00"
IDL_PREV="v1_05"

-- FIXME: solucao temporaria para simplificar os descritores que eram muito semelhantes
--        talvez seja melhor incorporar no puts um plugin 'tools.build.tecmakelualib'
--        isso ajudaria a padronizar a forma como descrever a compilacao das libs lua
local function descriptorPreloaderBasedGenerator(projname, target, projsrc, projurl, projgroup)
  assert(projname and target)
  projsrc = projsrc or PRODAPP.."/"..projname.."/src"
  projgroup = projgroup or projname -- group all loop, luacothread in 'loop' includes
  local tecmake_extra_args = " LUA51="..PRODAPP.."/lua5.1 LOOP_HOME="..PRODAPP.."/loop "
  local darwin_default_spec = { 
    mf = {
      target..tecmake_extra_args,
      target..tecmake_extra_args.." BUILD_DYLIB=Yes",
    },
  }
  
  return { name = projname,
    url = projurl,
    build = {
      type = "tecmake",
      src = projsrc or PRODAPP.."/"..projname.."/src",
      mf = { target..tecmake_extra_args, },
      Darwin = darwin_default_spec,
      MacOS = darwin_default_spec,
      SunOS510_64 = { mf = { target..tecmake_extra_args..SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/lib"..projname..".so"] = "lib",
      ["../lib/${TEC_UNAME}/lib"..projname..".dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/lib"..projname..".*"] = "lib",
      ["../obj/${TEC_UNAME}/"..projname..".h"] = "include/"..projgroup,
      [projname..".h"] = "include/"..projgroup,
    },
  }
end

packages = {
  -- package to download the sources of the oil, scs and friend projects
  { name = "oil-source",
    url = SVNREPURL .. "/oil/trunk",
    directory = PRODAPP .."/oil", 
  },
  { name = "idl-source",
    url = SVNREPURL .. "/openbus/idl/branches/openbus_v2_proto",
    directory = PRODAPP .."/idl",
    install_files = {
      ["src/*.idl"] = "idl/"..IDL_VERSION,
    },
  },
--[[
  { name = "idl-doc",
    build = {
      type = "command",
      src = PRODAPP .. "/idl/docs",
      cmd = "doxygen",
      arguments = "openbus.dox"
    },
    install_files = {
      ["html"] = "doc/openbus_"..IDL_VERSION,
    },
  },
]]
  { name = "idl-prev-source",
    url = SVNREPURL .. "/openbus/idl/tags/OB_IDL_v1_05_02_2011_08_03",
    directory = PRODAPP .."/idl-prev",
    install_files = {
      ["src/*.idl"] = "idl/"..IDL_PREV,
    },
  },
  { name = "idl-prev-doc",
    build = {
      type = "command",
      src = PRODAPP .. "/idl-prev/docs",
      cmd = "doxygen",
      arguments = "openbus.dox"
    },
    install_files = {
      ["html"] = "doc/openbus_"..IDL_PREV,
    },
  },
  { name = "sdk-java-source",
    url = SVNREPURL .. "/openbus/sdk/java/branches/v2_proto",
    directory = PRODAPP .."/sdk-java",
  },
  { name = "sdk-lua-source",
    url = SVNREPURL .. "/openbus/sdk/lua/branches/openbus_v2_proto",
    directory = PRODAPP .."/sdk-lua",
  },
  { name = "sdk-cpp-source",
    url = SVNREPURL .. "/openbus/sdk/cpp/branches/openbus_v2_proto",
    directory = PRODAPP .."/sdk-cpp",
  },
  { name = "openbus-source",
    url = SVNREPURL .. "/openbus/core/trunk",
    directory = SVNDIR, -- main source directory for PUts!
                        -- other sources have to be in PRODAPP/something
  },
  { name = "licenses",
    install_files = {
    [SVNDIR.."/LICENSE"] = ".",
    [SVNDIR.."/README"]  = ".",
    },
  },
  { name = "auxiliar-files",
    install_files = {
      [SVNDIR.."/specs/shell/openssl-generate.ksh"] = "bin",
    },
  },
  { name = "lua5.1",
    url = SVNREPURL .. "/openbus/libs/trunk/lua5.1.3",
    build = {
      type = "tecmake",
      src = PRODAPP .."/lua5.1/src",
      mf = { "config" },
      Darwin = { mf = {"config", "config BUILD_DYLIB=Yes"} },
      MacOS = { mf = {"config", "config BUILD_DYLIB=Yes"} },
      SunOS510_64 = { mf = { "config ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/liblua5.1.so"] = "lib",
      ["../lib/${TEC_UNAME}/liblua5.1.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/liblua5.1.*"] = "lib",
      ["../include/*"] = "include/lua5.1.3",
    },
  },
  { name = "lua5.1-bin",
    build = {
      type = "tecmake",
      src = PRODAPP .."/lua5.1/src",
      mf = { "lua", --[["luac", "bin2c",]] },
      SunOS510_64 = { mf = {"lua ".. SUNOS64_TECMAKE_FLAGS} },
    },
    install_files = {
      ["../bin/${TEC_UNAME}/lua5.1"] = "bin",
    },
  },
  { name = "tolua5.1",
    url = SVNREPURL .. "/openbus/libs/trunk/tolua5.1",
    build = {
      type = "tecmake",
      src = PRODAPP .."/tolua5.1/src",
      mf = { "tolua5lib LUA51=../../lua5.1", "tolua5 LUA51=../../lua5.1" },
      Darwin = { mf = {"tolua5lib LUA51="..PRODAPP.."/lua5.1", "tolua5lib BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1", "tolua5 LUA51="..PRODAPP.."/lua5.1"} },
      MacOS = { mf = {"tolua5lib LUA51="..PRODAPP.."/lua5.1", "tolua5lib BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1", "tolua5 LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "tolua5lib LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS, "tolua5 LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    dev_files = {
      ["../bin/${TEC_UNAME}/tolua5.1"] = "bin",
      ["../lib/${TEC_UNAME}/libtolua5.1.*"] = "lib",
      ["../include/tolua.h"] = "include/tolua5.1",
    },
  },
  { name = "luafilesystem",
    url = SVNREPURL .. "/openbus/libs/trunk/luafilesystem-1.4.2/",
    build = {
      type = "tecmake",
      src = PRODAPP .."/luafilesystem/src",
      mf = { "config LUA51=../../lua5.1", },
      Darwin = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      MacOS = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/liblfs.so"] = "lib",
      ["../lib/${TEC_UNAME}/liblfs.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/liblfs.*"] = "lib",
      ["../include/*"] = "include/luafilesystem",
    },
  },
  { name = "luasocket2",
    url = SVNREPURL .. "/openbus/libs/trunk/luasocket2",
    build = {
      type = "tecmake",
      src = PRODAPP .."/luasocket2/src",
      mf = { "config LUA51=../../lua5.1", },
      Darwin = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      MacOS = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/libluasocket.so"] = "lib",
      ["../lib/${TEC_UNAME}/libluasocket.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/libluasocket.*"] = "lib",
      ["luasocket.h"] = "include/luasocket2",
    },
  },
  descriptorPreloaderBasedGenerator("luastruct", "luastruct", nil, SVNREPURL .."/openbus/libs/trunk/struct-1.2"),
  descriptorPreloaderBasedGenerator("luavararg", "luavararg", nil, SVNREPURL .."/openbus/libs/trunk/vararg-1.1"),
  descriptorPreloaderBasedGenerator("loop", "loop", PRODAPP.."/loop/openbus", SVNREPURL .."/loop/trunk", "loop"),
  descriptorPreloaderBasedGenerator("luainspector", "inspector", PRODAPP.."/loop/openbus", nil, "loop"),
  descriptorPreloaderBasedGenerator("luacoroutine", "coroutine", PRODAPP.."/loop/openbus", nil, "loop"),
  descriptorPreloaderBasedGenerator("luacothread", "cothread", PRODAPP.."/loop/openbus", nil, "loop"),
  descriptorPreloaderBasedGenerator("luatuple", "tuple", PRODAPP.."/loop/openbus", nil, "loop"),
  descriptorPreloaderBasedGenerator("luaidl", "luaidl", PRODAPP.."/oil/openbus", nil, "oil"),
  descriptorPreloaderBasedGenerator("oil", "oil", PRODAPP.."/oil/openbus", nil, "oil"),
  { name = "luuid",
    url = SVNREPURL .. "/openbus/libs/trunk/luuid",
    build = {
      type = "tecmake",
      src = PRODAPP .."/luuid/src",
      mf = { "config LUA51=../../lua5.1", },
      Darwin = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      MacOS = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/libluuid.so"] = "lib",
      ["../lib/${TEC_UNAME}/libluuid.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/libluuid.*"] = "lib",
      ["../include/*"] = "include/luuid",
    },
  },
  { name = "lualdap-1.1.0",
    url = SVNREPURL .. "/openbus/libs/trunk/lualdap-1.1.0",
    build = {
      type = "tecmake",
      src = PRODAPP .."/lualdap-1.1.0/src",
      mf = { "config LUA51=../../lua5.1", },
      Darwin = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      MacOS = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/liblualdap.so"] = "lib",
      ["../lib/${TEC_UNAME}/liblualdap.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/liblualdap.*"] = "lib",
      ["../include/*"] = "include/lualdap-1.1.0",
    },
  },
  { name = "latt",
    url = SVNREPURL.."/luautils/latt/tags/v1_01_01_2012_05_09",
    build = {
      type = "tecmake",
      src = PRODAPP .."/latt",
      mf = { },
    },
    dev_files = {
      ["src/*"] = "lib/lua/5.1"
    },
  },
  { name = "scs-idl-prev",
    url = SVNREPURL .. "/scs/core/idl/branches/SCS_CORE_IDL_v1_02_2010_09_21",
    directory = PRODAPP .."/scs-idl-prev",
    install_files = {
      ["src/scs.idl"] = "idl/"..IDL_PREV,
    },
  },
  { name = "scs-idl",
    url = SVNREPURL .. "/scs/core/idl/trunk",
    directory = PRODAPP .."/scs-idl",
    install_files = {
      ["src/scs.idl"] = "idl/"..IDL_VERSION,
    },
  },
  { name = "scs-idl-doc",
    build = {
      type = "command",
      src = PRODAPP .. "/scs-idl/docs",
      cmd = "doxygen",
      arguments = "scs.dox"
    },
    install_files = {
      ["html"] = "doc/scs",
    },
  },
  { name = "luascs",
    url = SVNREPURL .. "/scs/core/lua/trunk",
    directory = PRODAPP .."/scs-lua",
    build = {
      type = "tecmake",
      src = PRODAPP .."/scs-lua/src",
      mf = { "config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1", },
      Darwin = { mf = {"config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1", "config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=Yes"} },
      MacOS = { mf = {"config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1", "config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=Yes"} },
      SunOS510_64 = { mf = { "config LOOP_HOME="..PRODAPP.."/loop LUA51="..PRODAPP.."/lua5.1 "..SUNOS64_TECMAKE_FLAGS, } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/libluascs.so"] = "lib",
      ["../lib/${TEC_UNAME}/libluascs.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/libluascs.*"] = "lib",
      ["../obj/${TEC_UNAME}/luascs.h"] = "include/scs/lua",
      ["../schema/*"] = "schema",
    },
  },
  { name = "scsoil",
    url = SVNREPURL .. "/scs/core/cppoil/trunk",
    directory = PRODAPP .."/scs-cppoil",
    build = {
      type = "tecmake",
      src = PRODAPP .."/scs-cppoil/src",
      mf = { "config LUA51="..PRODAPP.."/lua5.1", },
      Darwin = { mf = {
        "config LUA51="..PRODAPP.."/lua5.1",
        "config LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=Yes"}, },
      MacOS = { mf = {
        "config LUA51="..PRODAPP.."/lua5.1",
        "config LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=Yes"}, },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/libscsoil.so"] = "lib",
      ["../lib/${TEC_UNAME}/libscsoil.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/libscsoil.*"] = "lib",
      ["*.h"] = "include/scs/cppoil/",
      ["luaidl/*.h"] = "include/scs/cppoil/luaidl/",
    },
  },
  { name = "luatrace",
    url = SVNREPURL .. "/openbus/libs/trunk/luatrace",
    build = {
      type = "command",
      src = PRODAPP .."/luatrace",
      Linux = { cmd = "make PLAT=linux reader static-writer dynamic-writer "..
         "&& make PLAT=linux INSTALL_TOP=" .. TMPDIR  ..
         " install-reader install-static-writer install-dynamic-writer",
      },
    },
    install_files = {
        [TMPDIR .. "/bin/luatrace"]                       = "bin",
        [TMPDIR .. "/lib/libluatrace_*.so"]               = "lib",
        [TMPDIR .. "/lib/lua/5.1/trace/*.so"]             = "lib/trace",
        [TMPDIR .. "/lib/lua/5.1/trace/inputstream/*.so"] = "lib/trace/inputstream",
        [TMPDIR .. "/lib/lua/5.1/trace/msgdecoder/*.so"]  = "lib/trace/msgdecoder",
        [TMPDIR .. "/lib/lua/5.1/trace/msgreader/*.so"]   = "lib/trace/msgreader",
        [TMPDIR .. "/share/lua/5.1/trace/manager.lua"]    = "lib/lua/5.1/trace",
    },
  },
  { name = "lce",
    url = SVNREPURL.."/luautils/lce/trunk",
    build = {
      type = "tecmake",
      src = PRODAPP.."/lce/src",
      mf = { "config LUA51="..PRODAPP.."/lua5.1 LOOP_HOME="..PRODAPP.."/loop BUILD_DYLIB=Yes", },
      --Darwin = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      --MacOS = { mf = {"config LUA51="..PRODAPP.."/lua5.1", "config BUILD_DYLIB=Yes LUA51="..PRODAPP.."/lua5.1"} },
      SunOS510_64 = { mf = { "config LUA51="..PRODAPP.."/lua5.1 LOOP_HOME="..PRODAPP.."/loop ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/liblce*.so"] = "lib",
      ["../lib/${TEC_UNAME}/liblce*.dylib"] = "lib",
    },
    dev_files = {
      ["../include/*"] = "include/lce/",
      ["../lib/${TEC_UNAME}/liblce.*"] = "lib",
    },
  },
  { name = "openbus-lua",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-lua/src",
      mf = { "openbus LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop BUILD_DYLIB=YES" },
      --Darwin = { mf = { "config LUA51="..PRODAPP.."/lua5.1","config LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=YES" }, },
      --MacOS = { mf = { "config LUA51="..PRODAPP.."/lua5.1","config LUA51="..PRODAPP.."/lua5.1 BUILD_DYLIB=YES" }, },
      SunOS510_64 = { mf = { "openbus LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../lib/${TEC_UNAME}/libluaopenbus.so"] = "lib",
      ["../lib/${TEC_UNAME}/libluaopenbus.dylib"] = "lib",
    },
    dev_files = {
      ["../lib/${TEC_UNAME}/libluaopenbus.*"] = "lib",
      ["../obj/${TEC_UNAME}/luaopenbus.h"] = "include/openbus/lua/",
    },
  },
  { name = "openbus-luaconsole",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-lua/src",
      mf = { "busconsole LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ", },
      SunOS510_64 = { mf = { "busconsole LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../bin/${TEC_UNAME}/busconsole"] = "bin",
    },
  },
  { name = "openbus-busservices",
    build = {
      type = "tecmake",
      src = SVNDIR .."/src",
      mf = { "busservices LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ", },
      SunOS510_64 = { mf = { "busservices LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../bin/${TEC_UNAME}/busservices"] = "bin",
      ["../specs/management"] = "specs",
      ["../specs/shell"] = "specs",
      ["../specs/templates"] = "specs",
      ["../test/*"] = "test",
    },
    -- TODO: include here all templates/openbus.lua messages table!!
    conf_template = {
      SVNDIR .."/specs/templates/openbus.lua",
    },
    dev_files = {
      ["../test/*"] = "test",
    },
  },
  { name = "openbus-busadmin",
    build = {
      type = "tecmake",
      src = SVNDIR .."/src",
      mf = { "busadmin LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ", },
      SunOS510_64 = { mf = { "busadmin LUA51="..PRODAPP.."/lua5.1 OIL_HOME="..PRODAPP.."/oil LOOP_HOME="..PRODAPP.."/loop ".. SUNOS64_TECMAKE_FLAGS } },
    },
    install_files = {
      ["../bin/${TEC_UNAME}/busadmin"] = "bin",
    },
  },
  { name = "openbus-demo-hello-lua",
    directory = PRODAPP .."/sdk-lua/demo/hello",
    dev_files = {
      ["client.lua"] = "demo/lua/hello",
      ["server.lua"] = "demo/lua/hello",
      ["run"] = "demo/lua/hello",
      ["Hello.properties"] = "demo/lua/hello",
      ["idl"] = "demo/lua/hello",
      ["management"] = "demo/lua/hello",
    },
  },
  { name = "openbus-demo-eventsink-lua",
    directory = PRODAPP .."/sdk-lua/demo/eventSink",
    dev_files = {
      ["client.lua"] = "demo/lua/eventSink",
      ["client.sh"] = "demo/lua/eventSink",
      ["server.lua"] = "demo/lua/eventSink",
      ["server.sh"] = "demo/lua/eventSink",
      ["EventSink.properties"] = "demo/lua/eventSink",
      ["management"] = "demo/lua/eventSink",
    },
  },
  { name = "openbus-demo-delegate-lua",
    directory = PRODAPP .."/sdk-lua/demo/delegate",
    dev_files = {
      ["client.lua"] = "demo/lua/delegate",
      ["server.lua"] = "demo/lua/delegate",
      ["run"] = "demo/lua/delegate",
      ["Delegate.properties"] = "demo/lua/delegate",
      ["idl"] = "demo/lua/delegate",
      ["management"] = "demo/lua/delegate",
    },
  },
  -- MICO related packages
  { name = "scs-cpp-micomultithread",
    url = SVNREPURL .. "/scs/core/cpp/trunk",
    directory = PRODAPP .."/scs-cpp",
    build = {
      type = "tecmake",
      src = PRODAPP .."/scs-cpp",
      mf = { 
        "mico genstubs SCS_THREADING_ENABLED=Yes", 
        "mico LUA51="..PRODAPP.."/lua5.1 SCS_THREADING_ENABLED=Yes" 
      },
      Darwin = {
        mf = { 
          "mico genstubs LD=g++ SCS_THREADING_ENABLED=Yes", 
          "mico BUILD_DYLIB=Yes LD=g++ LUA51="..PRODAPP.."/lua5.1 SCS_THREADING_ENABLED=Yes" 
        },
      },
      MacOS = {
        mf = { 
          "mico genstubs LD=g++ SCS_THREADING_ENABLED=Yes", 
          "mico BUILD_DYLIB=Yes LD=g++ LUA51="..PRODAPP.."/lua5.1 SCS_THREADING_ENABLED=Yes" 
        },
      },
    },
    install_files = {
      ["lib/${TEC_UNAME}/libscs-micomultithread.*"] = "lib",
      -- to make sure that .idl files will be in the .tar.gz package
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/scs.idl"] =
          "idl/"..IDL_VERSION,
    },
    dev_files = {
      ["lib/${TEC_UNAME}/libscs-micomultithread.*"] = "lib",
      -- to make sure that .idl files will be in the .tar.gz package
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/scs.idl"] =
          "idl/"..IDL_VERSION,
      ["include/scs/*"] = "include/scs",
    },
  },
  { name = "scs-cpp-micosinglethread",
    url = SVNREPURL .. "/scs/core/cpp/trunk",
    directory = PRODAPP .."/scs-cpp",
    build = {
      type = "tecmake",
      src = PRODAPP .."/scs-cpp",
      mf = { 
        "mico genstubs", 
        "mico LUA51="..PRODAPP.."/lua5.1"
      },
      Darwin = {
        mf = { 
          "mico genstubs LD=g++", 
          "mico BUILD_DYLIB=Yes LD=g++ LUA51="..PRODAPP.."/lua5.1" 
        },
      },
      MacOS = {
        mf = { 
          "mico genstubs LD=g++", 
          "mico BUILD_DYLIB=Yes LD=g++ LUA51="..PRODAPP.."/lua5.1" 
        },
      },
    },
    install_files = {
      ["lib/${TEC_UNAME}/libscs-micosinglethread.*"] = "lib",
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/scs.idl"] =
          "idl/"..IDL_VERSION,
      ["stubs/mico"] = "include/scs/stubs",
    },
    dev_files = {
      ["lib/${TEC_UNAME}/libscs-micosinglethread.*"] = "lib",
      -- to make sure that .idl files will be in the .tar.gz package
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/scs.idl"] =
          "idl/"..IDL_VERSION,
      ["include/scs/*"] = "include/scs",
    },
  },
  { name = "openbus-sdkcpp-micomultithread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp",
      mf = { 
        "config genstubs OPENBUS_SDK_MULTITHREAD=Yes", 
        "config  OPENBUS_SDK_MULTITHREAD=Yes" },
      Darwin = {
        mf = { 
          "config genstubs LD=g++ OPENBUS_SDK_MULTITHREAD=Yes", 
          "config LD=g++ OPENBUS_SDK_MULTITHREAD=Yes" 
        },
      },
      MacOS = {
        mf = { 
          "config genstubs LD=g++ OPENBUS_SDK_MULTITHREAD=Yes", 
          "config LD=g++ OPENBUS_SDK_MULTITHREAD=Yes" 
        },
      },
    },
    dev_files = {
      ["lib/${TEC_UNAME}/libopenbus-micomultithread.*"] = "lib",
      ["include/*.h"] = "include/openbus/cpp", --include
      ["include/interceptors/*.h"] = "include/openbus/cpp/interceptors/",    --include
      ["include/util/*.h"] = "include/openbus/cpp/util/",    --include
      ["stubs"] = "include/openbus/cpp",     --include
      ["legacy/idl/*"] = "idl/legacy/openbus/cpp",     --include
      [INSTALL.TOP.."/idl/"..IDL_PREV.."/*"] = "idl/"..IDL_PREV,
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/*"] = "idl/"..IDL_VERSION,
    },
  },
  { name = "openbus-sdkcpp-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp",
      mf = { 
        "config genstubs", 
        "config" },
      Darwin = {
        mf = { 
          "config genstubs LD=g++", 
          "config LD=g++" 
        },
      },
      MacOS = {
        mf = { 
          "config genstubs LD=g++", 
          "config LD=g++" 
        },
      },
    },
    dev_files = {
      ["lib/${TEC_UNAME}/libopenbus-micosinglethread.*"] = "lib",
      ["include/*.h"] = "include/openbus/cpp", --include
      ["include/interceptors/*.h"] = "include/openbus/cpp/interceptors/",    --include
      ["include/util/*.h"] = "include/openbus/cpp/util/",    --include
      ["stubs"] = "include/openbus/cpp",     --include
      ["legacy/idl/*"] = "idl/legacy/openbus/cpp",     --include
      [INSTALL.TOP.."/idl/"..IDL_PREV.."/*"] = "idl/"..IDL_PREV,
      [INSTALL.TOP.."/idl/"..IDL_VERSION.."/*"] = "idl/"..IDL_VERSION,
    },
  },
  { name = "openbus-interop-hello-sdkcpp-micomultithread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/hello",
      mf = { 
        "server genstubs OPENBUS_SDK_MULTITHREAD=Yes", 
        "client LUA51="..PRODAPP.."/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes",
        "server LUA51="..PRODAPP.."/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes" 
      },
      SunOS510 = { 
        mf = { 
          "server genstubs OPENBUS_SDK_MULTITHREAD=Yes",
          'client "LUA51='..PRODAPP..'/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes"',
          'server "LUA51='..PRODAPP..'/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes"',
        }, 
      },
      SunOS510_64 = { 
        mf = { "server genstubs USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes", 
               "server LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes"}, 
      }
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/hello/bin",
      ["../idl/hello.idl"] = "interop/hello/idl/",
      ["admin"] = "interop/hello",
      ["../../README"] = "interop",      
      ["src/client.cpp"] = "interop/hello/src",
      ["src/server.cpp"] = "interop/hello/src",
      ["*.mak"] = "interop/hello",
      ["*config"] = "interop/hello",
      ["client"] = "interop/hello",
      ["server"] = "interop/hello",
    },
  },
  { name = "openbus-interop-hello-sdkcpp-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/hello",
      mf = { 
        "server genstubs", 
        "client LUA51="..PRODAPP.."/lua5.1",
        "server LUA51="..PRODAPP.."/lua5.1" 
      },
      SunOS510 = { 
        mf = { 
          "server genstubs ",
          'client "LUA51='..PRODAPP..'/lua5.1"',
          'server "LUA51='..PRODAPP..'/lua5.1"',
        }, 
      },
      SunOS510_64 = { 
        mf = { "server genstubs USE_NODEPEND=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes", 
               "server LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes"}, 
      }
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/hello/bin",
      ["idl"] = "interop/hello",
      ["admin"] = "interop/hello",
      ["../../README"] = "interop",      
      ["src/client.cpp"] = "interop/hello/src",
      ["src/server.cpp"] = "interop/hello/src",
      ["*.mak"] = "interop/hello",
      ["*config"] = "interop/hello",
      ["client"] = "interop/hello",
      ["server"] = "interop/hello",
    },
  },
  { name = "openbus-interop-singlesignon-sdkcpp-micomultithread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/singlesignon",
      mf = { 
        "client genstubs OPENBUS_SDK_MULTITHREAD=Yes", 
        "client LUA51="..PRODAPP.."/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes",
        "client-singlesignon LUA51="..PRODAPP.."/lua5.1 OPENBUS_SDK_MULTITHREAD=Yes" 
      },
      SunOS510_64 = { 
        mf = { "client genstubs USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes", 
               "client-singlesignon LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes OPENBUS_SDK_MULTITHREAD=Yes"}, 
      }
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/singlesignon/bin",
      ["../../README"] = "interop",      
      ["src/client.cpp"] = "interop/singlesignon/src",
      ["src/client-singlesignon.cpp"] = "interop/singlesignon/src",
      ["*.mak"] = "interop/singlesignon",
      ["*config"] = "interop/singlesignon",
      ["client"] = "interop/singlesignon",
      ["client-singlesignon"] = "interop/singlesignon",
    },
  },
  { name = "openbus-interop-singlesignon-sdkcpp-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/singlesignon",
      mf = { 
        "client genstubs", 
        "client LUA51="..PRODAPP.."/lua5.1",
        "client-singlesignon LUA51="..PRODAPP.."/lua5.1" 
      },
      SunOS510_64 = { 
        mf = { "client genstubs USE_NODEPEND=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes", 
               "client-singlesignon LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes"}, 
      }
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/singlesignon/bin",
      ["../../README"] = "interop",      
      ["src/client.cpp"] = "interop/singlesignon/src",
      ["src/client-singlesignon.cpp"] = "interop/singlesignon/src",
      ["*.mak"] = "interop/singlesignon",
      ["*config"] = "interop/singlesignon",
      ["client"] = "interop/singlesignon",
      ["client-singlesignon"] = "interop/singlesignon",
    },
  },
  { name = "openbus-interop-delegation-sdkcpp-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/delegation",
      mf = { 
        "airport genstubs", 
        "airport LUA51="..PRODAPP.."/lua5.1",
        "certifier LUA51="..PRODAPP.."/lua5.1",
        "client LUA51="..PRODAPP.."/lua5.1",
      },
      SunOS510 = { 
        mf = { 
          "airport genstubs ",
          'airport "LUA51='..PRODAPP..'/lua5.1"',
          'certifier "LUA51='..PRODAPP..'/lua5.1"',
          'client "LUA51='..PRODAPP..'/lua5.1"',
        }, 
      },
      SunOS510_64 = { 
        mf = { "airport genstubs USE_NODEPEND=Yes", 
               "airport LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes", 
               "certifier LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes",
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes",
        },
      },
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/delegation/bin",
      ["idl"] = "interop/delegation",
      ["admin"] = "interop/delegation",
      ["../../README"] = "demo",      
      ["src/airport.cpp"] = "interop/delegation/src",
      ["src/certifier.cpp"] = "interop/delegation/src",
      ["src/client.cpp"] = "interop/delegation/src",
      ["*.mak"] = "interop/delegation",
      ["*config"] = "interop/delegation",
      ["airport"] = "interop/delegation",
      ["certifier"] = "interop/delegation",
      ["client"] = "interop/delegation",
    },
  },
  { name = "openbus-interop-multiplexing-sdkcpp-micomultithread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/multiplexing/multithread",
      mf = { 
        "server genstubs", 
        "server LUA51="..PRODAPP.."/lua5.1",
        "client LUA51="..PRODAPP.."/lua5.1",
      },
      SunOS510 = { 
        mf = { 
          "server genstubs",
          'server "LUA51='..PRODAPP..'/lua5.1"',
          'client "LUA51='..PRODAPP..'/lua5.1"',
        }, 
      },
      SunOS510_64 = { 
        mf = { "server genstubs USE_NODEPEND=Yes", 
               "server LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes",
        },
      },
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/multiplexing/multithread/bin",
      ["idl"] = "interop/hello/multithread",
      ["admin"] = "interop/multiplexing/multithread",
      ["../../README"] = "demo",      
      ["src/server.cpp"] = "interop/multiplexing/multithread/src",
      ["src/client.cpp"] = "interop/multiplexing/multithread/src",
      ["*.mak"] = "interop/multiplexing/multithread",
      ["*config"] = "interop/multiplexing/multithread",
      ["server"] = "interop/multiplexing/multithread",
      ["client"] = "interop/multiplexing/multithread",
    },
  },
  { name = "openbus-interop-multiplexing-sdkcpp-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/interop/multiplexing/singlethread",
      mf = { 
        "server genstubs", 
        "server LUA51="..PRODAPP.."/lua5.1",
        "client LUA51="..PRODAPP.."/lua5.1",
      },
      SunOS510 = { 
        mf = { 
          "server genstubs ",
          'server "LUA51='..PRODAPP..'/lua5.1"',
          'client "LUA51='..PRODAPP..'/lua5.1"',
        }, 
      },
      SunOS510_64 = { 
        mf = { "server genstubs USE_NODEPEND=Yes", 
               "server LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes", 
               "client LUA51="..PRODAPP.."/lua5.1 USE_NODEPEND=Yes",
        },
      },
    },
    dev_files = {
      ["bin/${TEC_UNAME}/*"] = "interop/multiplexing/singlethread/bin",
      ["idl"] = "interop/multiplexing/singlethread",
      ["admin"] = "interop/multiplexing/singlethread",
      ["../../README"] = "demo",      
      ["src/server.cpp"] = "interop/multiplexing/singlethread/src",
      ["src/client.cpp"] = "interop/multiplexing/singlethread/src",
      ["*.mak"] = "interop/multiplexing/singlethread",
      ["*config"] = "interop/multiplexing/singlethread",
      ["server"] = "interop/multiplexing/singlethread",
      ["client"] = "interop/multiplexing/singlethread",
    },
  },
  { name = "openbus-sdkcpp-test-micosinglethread",
    build = {
      type = "tecmake",
      src = PRODAPP .."/sdk-cpp/tests",
      mf = { 
        "genstubs genstubs",
        "fail_user_created_orb",
        "connect_host_port_connect_to_wrong_host_and_port",
        "get_offer",
        "single_signon",
        "register_service",
--        "connect_orb_connect_getting_orb_with_ORB_init",
        "connect_orb_connect_getting_orb_with_createORB",
        "connect_host_port_connect_to_right_host_and_port",
        "connection_login_login_info_after_login",
        "connection_loginByCertificate_entity_id_and_file_private_key_ok",
        "connection_loginByPassword_after_logout",
        "connection_loginByPassword_entity_id_and_password_ok",
        "connection_loginByPassword_login_when_already_logged",
        "connection_loginByPassword_wrong_password",
      },
    },
    install_files = {
      ["../tests/bin/"..TEC_UNAME.."/*"] = "test/sdkcpp/",
      ["../tests/runtests.mak"] = "test/sdkcpp/",
    },
  },
  { name = "openbus-sdkcpp-run-tests",
    build = {
      type = "tecmake",
      src = INSTALL.TOP.."/test/sdkcpp",
      mf = { 
        "runtests run",
      },
    },
    install_files = {
      ["../tests/bin/"..TEC_UNAME.."/*"] = "test/sdkcpp/",
    },
  },
  -- Java related packages  
  { name = "scsidl-java",
    build = {
      type = "maven",
      src = PRODAPP .."/scs-idl",
    },
    install_files = {
      ["target/*.jar"] = "lib",
      ["target/dependency/*.jar"] = "lib",
    },
  },
  { name = "scs-java",
    url = SVNREPURL .. "/scs/core/java/trunk",
    directory = PRODAPP .."/scs-java",
    build = {
      type = "maven",
      src = PRODAPP .."/scs-java",
    },
    install_files = {
      ["target/*.jar"] = "lib",
      ["target/dependency/*.jar"] = "lib",
    },
  },
  { name = "openbusapi-java",
    build = {
      type = "maven",
      src = PRODAPP .."/sdk-java",   
    },
    install_files = {
      ["core/target/openbus*.jar"] = "lib",
      ["core/target/dependency/*.jar"] = "lib",
      ["demo/hello/target/openbus-sdk-demo-hello-*.jar"] = "demo/java/hello",
      ["demo/hello/target/dependency/*.jar"] = "lib",
      ["demo/delegation/target/openbus-sdk-demo-delegation-*.jar"] = "demo/java/delegation",
      ["demo/delegation/target/dependency/*.jar"] = "lib",
      ["demo/singlesignon/target/openbus-sdk-demo-singlesignon-*.jar"] = "demo/java/singlesignon",
      ["demo/singlesignon/target/dependency/*.jar"] = "lib",
      ["demo/multiplexing/target/openbus-sdk-demo-multiplexing-*.jar"] = "demo/java/multiplexing",
      ["demo/multiplexing/target/dependency/*.jar"] = "lib",
    },
    dev_files = {
      ["demo/hello/target/openbus-sdk-demo-hello-*.jar"] = "demo/java/hello",
      ["demo/hello/target/dependency/*.jar"] = "lib",
      ["demo/hello/resources"] = "demo/java/hello",
      ["demo/hello/src"] = "demo/java/hello",
      ["demo/hello/idl"] = "demo/java/hello",
      ["demo/hello/management"] = "demo/java/hello",
      ["demo/delegation/target/openbus-sdk-demo-delegation-*.jar"] = "demo/java/delegation",
      ["demo/delegation/target/dependency/*.jar"] = "lib",
      ["demo/delegation/resources"] = "demo/java/delegation",
      ["demo/delegation/src"] = "demo/java/delegation",
      ["demo/delegation/idl"] = "demo/java/delegation",
      ["demo/delegation/management"] = "demo/java/delegation",
      ["demo/singlesignon/target/openbus-sdk-demo-singlesignon-*.jar"] = "demo/java/singlesignon",
      ["demo/singlesignon/target/dependency/*.jar"] = "lib",
      ["demo/singlesignon/resources"] = "demo/java/singlesignon",
      ["demo/singlesignon/src"] = "demo/java/singlesignon",
      ["demo/singlesignon/idl"] = "demo/java/singlesignon",
      ["demo/singlesignon/management"] = "demo/java/singlesignon",
      ["demo/multiplexing/target/openbus-sdk-demo-multiplexing-*.jar"] = "demo/java/multiplexing",
      ["demo/multiplexing/target/dependency/*.jar"] = "lib",
      ["demo/multiplexing/resources"] = "demo/java/multiplexing",
      ["demo/multiplexing/src"] = "demo/java/multiplexing",
      ["demo/multiplexing/idl"] = "demo/java/multiplexing",
      ["demo/multiplexing/management"] = "demo/java/multiplexing",
    },
  },
  { name = "openbusapi-java-doc",
    build = {
      type = "command",
      src = PRODAPP .. "/sdk-java/core",
      cmd = "mvn",
      rebuild = "clean",
      arguments = "javadoc:javadoc -Dquiet",
    },
    install_files = {
      ["target/site/apidocs"] = "doc",
    },
  },
--  { name = "ldap-Linux26g4",
--    src = "/",
--    mf = { },
--    install_files = {
--      ["/usr/lib/libldap.so.2"] = "libpath/${TEC_UNAME}/",
--    },
--    dev_files = {
--      ["/usr/include/ldap.h"] = "incpath/ldap/",
--    },
--  },
}
-- temporary hack! em breve vou renomear definitivamente a tabela packages e
-- ela vai ficar incompativel com versoes antigas do 'tools.compile'
descriptors = packages
