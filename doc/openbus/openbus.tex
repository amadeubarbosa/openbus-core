%
%  OpenBus 2.0
%
%  Created by Hugo Roenick on 2012-05-22.
%  Copyright (c) 2012 Tecgraf/PUC-Rio. All rights reserved.
%
\documentclass[]{article}

% Use utf-8 encoding for foreign characters
\usepackage[latin1]{inputenc}

\usepackage[brazil]{babel}

% Setup for fullpage use
\usepackage{fullpage}

% Uncomment some of the following if you use the features
%
% Running Headers and footers
%\usepackage{fancyhdr}

% Multipart figures
%\usepackage{subfigure}

% More symbols
%\usepackage{amsmath}
%\usepackage{amssymb}
%\usepackage{latexsym}

\usepackage{hyperref}

% Surround parts of graphics with box
\usepackage{boxedminipage}

% Package for including code in the document
\usepackage{mwlabinputs2}

% If you want to generate a toc for each chapter (use with book)
\usepackage{minitoc}

% This is now the recommended way for checking for PDFLaTeX:
\usepackage{ifpdf}

%% Redefines the label 'Listing' for ..
\def\lstlistingname{Código}
\codestyle{colorful}

% new commands
\newcommand{\term}[1]{\textit{#1}}
\newcommand{\code}[1]{\texttt{#1}}

\newcommand{\openbus}{\textsc{OpenBus}}
\newcommand{\corba}{\textsc{CORBA}}
\newcommand{\orb}{\textsc{ORB}}
\newcommand{\scs}{\textsc{SCS}}
\newcommand{\lua}{\textsc{Lua}}
\newcommand{\oil}{\textsc{OiL}}
\newcommand{\version}{2.0.0}


%\newif\ifpdf
%\ifx\pdfoutput\undefined
%\pdffalse % we are not running PDFLaTeX
%\else
%\pdfoutput=1 % we are running PDFLaTeX
%\pdftrue
%\fi

\ifpdf
\usepackage[pdftex]{graphicx}
\else
\usepackage{graphicx}
\fi

\title{Manual de referência do \openbus{} \version{}}
\author{TecGraf}

\date{\today}

\begin{document}

\ifpdf
\DeclareGraphicsExtensions{.pdf, .jpg, .tif}
\else
\DeclareGraphicsExtensions{.eps, .jpg}
\fi

\maketitle

\tableofcontents


\section{Introdução}

Este documento tem como objetivo apresentar o \openbus{} \version{} e seus conceitos principais. 
Nesta seção introdutória apresentaremos uma definição do projeto e os motivadores para o seu uso.
Na seção~\ref{sec:architecture} apresentamos a arquitetura ...

\subsection{O que é ?}
O \openbus{}~\cite{web:OPENBUS} é uma arquitetura aberta e orientada a serviços (\emph{Service-Oriented Architecture}, ou SOA~\cite{erl2005service}) para integrar, de forma segura, dados e aplicações heterogêneas de domínios distintos ou não.
A arquitetura é baseada em um \emph{barramento} em que os usuários se conectam para consumir ou prover serviços.

\subsection{Por que utilizar o \openbus{}?}
Quando há necessidade de integração entre aplicações, algumas soluções podem ser apresentadas conforme a complexidade do ambiente a ser integrado.
Caso o problema se resuma a troca de dados entre as aplicações, uma primeira solução é a integração externa, que consiste na exportação do dado em um determinado formato padronizado que possa ser carregado pela aplicação de destino.
Este processo é normalmente manual, deixando a cargo do usuário, ou do \emph{job} que automatiza o processo, a responsabilidade pela sua execução.
Um outro problema é a possibilidade de ocorrer perda de informação quando o formato padrão utilizado não consegue representar corretamente o dado de origem. 

As opções de soluções disponíveis para a integração, podem ser ampliadas quando há a presença de aplicações de código aberto ou que ofereçam interfaces de programação.
Para estes casos, uma integração programática pode ser realizada de forma direta, através de uma implementação que permita ao usuário comandar a transferência de dados.
Este modo de interação agrega mais qualidade, diminuindo as chances de perda de informação durante a transferência do dado, pois os metadados das aplicações envolvidas podem ser considerados.
Além da troca de dados, há a possibilidade de troca de mensagens entre as aplicações.
O problema desta solução é que uma ponte deve ser desenvolvida para cada par de aplicações, o que resulta em um número quadrático de codificações de pontes em relação ao número de aplicações.
Por exemplo, para integrar 10 aplicações precisamos implementar 45 pontes.
Além disso, a troca de mensagens é naturalmente limitada entre cada par de aplicações.

Os problemas apresentados acima pela programática direta, podem ser eliminados com a adoção de uma plataforma comum de integração entre aplicações.
Como por exemplo um \emph{barramento}, em que cada aplicação se conecta a este, segundo um protocolo próprio deste barramento, e carrega ou exporta dados para outras aplicações também conectadas ao barramento.
Essa arquitetura define uma linguagem comum entre todas as aplicações, e, induz o compartilhamento de interfaces bem definidas para os serviços comuns entre as aplicações envolvidas.
Desta forma o esforço de codificação das pontes pode ser reduzido para um esforço linear, ou seja, para se integrar \emph{n} aplicações, \emph{n} pontes são necessárias.
No mais, a troca de mensagens dinâmicas entre todas as aplicações passa a ser possível, possibilitando um ambiente de colaboração entre as aplicações.

\section{Arquitetura}\label{sec:architecture}

O \openbus{} é um sistema que pode ser essencialmente divido em três partes: o barramento, os serviços núcleo, e os serviços extras.
A figura~\ref{fig:architecture}, apresenta a arquitetura do \openbus{} e suas partes principais. 
Entraremos em detalhes sobre as partes principais do \openbus{} nas subseções a seguir.

\begin{figure} [htb]
\centering
\includegraphics[width=0.9\textwidth]{./figs/openbus.pdf}
\caption{Arquitetura do \openbus{}}
\label{fig:architecture}
\end{figure}

\subsection{Barramento}\label{subsec:barramento}

O barramento serve como o meio de comunicação do sistema, sendo responsável pela validação do acesso ao sistema, e por permitir a comunicação entre os serviços e as aplicações.
O barramento é composto por um serviço de Controle de Acesso e pelo uso do \emph{middleware} \corba{}~\cite{omg08corbaspec}, com os quais especifica um protocolo de acesso.

O Controle de Acesso serve como ponto de entrada do barramento, sendo responsável por autenticar, renovar e gerenciar os logins de serviços e aplicações ao barramento. 
A autenticação de login é uma verificação realizada no estabelecimento de um login que permite associá-lo a uma dada entidade.
A autenticação pode ser feita através de uma senha (login por senha), certificado previamente registrado no barramento (login por certificado), ou através do compartilhamento de uma autorização de um login previamente estabelecido (login por single sign-on).

O resultado da autenticação é a criação de um login, que representa uma autenticação de uma entidade junto ao barramento para poder acessá-lo. 
Todo login possui um tempo de validade (lease), no qual permanecerá válido sem necessidade de renovação, mas deve ser renovada para que não expire. 
Contudo, um login pode ser invalidado explicitamente por um administrador antes do tempo de lease.

O \emph{middleware} \corba{} (\emph{Common Object Request Broker Architecture}) é a espeficiação de um padrão de \orb{} sobre a qual o \openbus{} é definido e implementado, e é a tecnologia adotada para provêr suporte à comunicação de objetos distribuídos em múltiplas linguagens.
O \openbus{} pode ser visto como uma extensão do padrão \corba{}.

Por sua vez, o protocolo de acesso é o conjunto de regras para realização de chamadas \corba{} através de um barramento \openbus{}, que foi introduzido na versão \version{} do \openbus{}.
O principal objetivo desse protocolo é garantir um nível adequado de segurança das chamadas que permita assegurar a identidade da entidade que iniciou cada chamada realizada através do barramento.
Maiores informações sobre o protocolo podem ser encontradas no documento de especificação do protocolo~\cite{ob2.0protospec}.

Para facilitar o trabalho de integração de serviços e aplicações no barramento, oferecemos uma biblioteca de acesso~\cite{sdk2.0.0-cpp,sdk2.0.0-csharp,sdk2.0.0-java,sdk2.0.0-lua}, que implementa o protocolo de acesso e exporta uma interface de programação (API). 
A biblioteca de acesso é implementada nas linguages: C++, C\#, Java e Lua.

\subsection{Serviços Núcleo}

Serviços Núcleo são os serviços oferecidos pelo próprio barramento, tipicamente acessados através da API (\emph{Application Program Interface}), que é a interface de programação oferecida às aplicações que precisam acessar o barramento, seja para fazer ou receber chamadas através do barramento, ou acessar serviços oferecidos pelo barramento.

Atualmente o barramento possui apenas um serviço núcleo, que é o Registro de Ofertas. 
Através dele é possível registrar e buscar serviços oferecidos no barramento, além de permitir a inscrição observadores de registros de ofertas.

\subsubsection{Registro de Ofertas}

O Registro de Ofertas é um serviço núcleo do barramento, que permite que entidades publiquem e busquem ofertas de serviços no barramento.
Uma oferta de serviço corresponde a um cadastro no Registro de Ofertas de um conjunto de propriedades e um componente \scs{}~\cite{web:SCS}, que implementa um conjunto de interfaces que representam um dado serviço a ser utilizado através do barramento.

Uma propriedade da oferta corresponde a um par de nome e valor, que ao registrar uma oferta de serviço no barramento, a entidade pode definir um conjunto de propriedades correspondentes à oferta, que poderão ser utilizadas como critério de filtro no momento de buscar por ofertas de serviço no Registro de Ofertas.
Toda oferta publicada no barramento possui um conjunto de propriedades geradas automaticamente, como a data do registro, a entidade que publicou a oferta, a versão do componente, entre outras.

O Registro de Ofertas também disponibiliza um mecanismo de observação de publicação, atualização e remoção de ofertas.
Maiores detalhes sobre a especificação e o uso do serviço de Registro de Ofertas podem ser encontrados nos seu manuais de uso das bibliotecas de acesso~\cite{sdk2.0.0-cpp,sdk2.0.0-csharp,sdk2.0.0-java,sdk2.0.0-lua}


\subsection{Serviços Extras}

A categoria de Serviços Extras define os serviços acrescentam funcionalidades para auxiliar a integração entre serviços e aplicações, mas que não são parte do núcleo do barramento.
Não é obrigatória a presença desses serviços em uma instância do barramento.

Nesta versão atual do \openbus{} disponibilizamos apenas um serviço extra: o Serviço de Colaboração.
Esse serviço tem como principais funcionalidades:

\begin{itemize}
  \item criar e compartilhar uma sessão de colaboração
  \item oferecer um canal de comunicação para enviar eventos para todos os membros da sessão
\end{itemize} 

Não entraremos em maiores detalhes sobre as funcionalidades e o uso do Serviço de Colaboração neste documento. Para mais informações, consulte o manual do serviço~\cite{collaboration1.0}.

\section{Perspectivas}

Agora que já apresentamos a arquitetura e os conceitos gerais do \openbus{}, iremos falar um pouco sobre algumas características específicas do \openbus{}, que dependem do papel que o usuário tem no barramento.

O \openbus{} não traz para a sua implementação uma distinção entre administrador e gerente do barramento.
Ambos desempenham papéis de administração.
Porém, entendemos que nem sempre o administrador do barramento também irá gerenciar o barramento. Logo, vamos separar esses dois conceitos e apresentar os conceitos do barramento que competem a cada um desses perfis.

\subsection{\openbus{} para Administradores}

Esta seção apresenta alguns conceitos que são importantes para os administradores do barramento, onde por administradores consideramos as pessoas que possuem acesso a máquina onde o barramento será executado e são os responsáveis por levantar e parar o barramento.

O barramento e os serviços núcleo são distribuídos em um mesmo programa, o \emph{busservice}. Logo, para disparar o barramento, basta executar o programa passando as suas configurações por linha de comando ou por arquivo de configuração.
Se uma configuração não for explicitada, será utilizado o seu valor padrão.

As opções de configuração são:
\begin{description}

  \item [host] endereço de rede usado pelo barramento.
Valor padrão é ``*", que significa que vai ouvir em todos os IPs da máquina.
  \item [port] número da porta usada pelo barramento.
Valor padrão é 2089.

  \item [database] arquivo de dados do barramento.
Valor padrão é ``openbus.db".
  \item [certificate] arquivo com certificado do barramento.
Valor padrão é ``openbus.crt"
  \item [privatekey] arquivo com chave privada do barramento.
Valor padrão é ``openbus.key"

  \item [leasetime] tempo em segundos de lease dos logins de acesso.
Valor padrão é 180 segundos.
  \item [expirationgap] tempo em segundos que os logins ficam válidos após o lease.
Valor padrão é 10 segundos. 

  \item [admin] usuário com privilégio de administração.
Não é definido um valor padrão.
  \item [validator] nome de pacote de validação de login.
Não é definido um valor padrão.

  \item [loglevel] nível de log gerado pelo barramento.
O valor padrão é 3. Os níveis vão de 0 a 5, onde 5 é o nível com mais detalhes, e o 0 desativa o log.
  \item [logfile] arquivo de log gerado pelo barramento.
Não é definido um valor padrão.
  \item [oilloglevel] nível de log gerado pelo \oil{}~\cite{maia06oil,web:oil} (debug).
  O valor padrão é 0. Os níveis vão de 0 a 5, onde 5 é o nível com mais detalhes, e o 0 desativa o log.
  \item [oillogfile] arquivo de log gerado pelo \oil{} (debug).
  Não é definido um valor padrão.

  \item [noauthorizations] desativa o suporte a autorizações de oferta.
  \item [nolegacy] desativa o suporte à versão antiga do barramento.

  \item [configs] arquivo de configurações adicionais do barramento.
O valor padrão é ``openbus.cfg".
  
\end{description}

As opções ``admin" e ``validator" podem receber mais de um valor.
Quando essas opções são configuradas por linha de comando, basta repetir a opção o número de vezes desejadas.
Quando são configuradas através do arquivo de configuração, é necessário informar a lista de valores desejados, no formato de uma tabela \lua{}~\cite{web:lua}.
O código~\ref{lst:openbus.cfg} apresenta um exemplo de arquivo do configuração.

\begin{samplelisting}[language=lua]{openbus.cfg}{Exemplo de arquivo de configuração.}
validator = {"openbus.test.core.services.TesterUserValidator"}
loglevel = 5 
admin = {"admin1", "admin2"}
leasetime = 30
\end{samplelisting}

Existem duas formas de se definir o arquivo de configuração que o programa irá utilizar: utilizando a opção ``config'' por linha de comando, ou definindo um valor para a variável de ambiente \emph{OPENBUS\_CONFIG}.
O \emph{busservices} foi pensado para que as opções passadas por linha de comando tenham prioridade (sobrescrevam) sobre as opções definidas no arquivo de configuração.

O barramento possui algumas características importantes e devem ser mencionadas.
Uma delas, é que o barramento procura persistir todo o seu estado no diretório de dados (definido através da opção ``database'').
Dessa forma, sempre que o ele é iniciado, e o mesmo já possui uma base de dados populada, esses dados serão recarregados e farão parte do estado inicial do barramento.

Outra característica importante é que o barramento mantém compatibilidade com a API da versão imediatamente anterior.
Ou seja, mesmo que a versão do barramento evolua, os clientes (serviços e aplicações) ainda conseguem acessar o barramento utilizando bibliotecas de acesso de uma versão anterior.
O \openbus{} utiliza um esquema de versionamento com quatro números, no formato \emph{A.B.C\_D}, onde:

\begin{itemize}
  \item Campos \textbf{A} e \textbf{B} significam a versão da IDL e deve ser igual em todos os pacotes que são compatíveis: versão IDL, barramento e bibliotecas de acesso.
  \item Campo \textbf{C} é incrementado quando ocorre alguma modificação na API interna.
  \item Campo \textbf{D} representa uma versão apenas com correções de falhas.
\end{itemize}

Sendo assim, o barramento 2.0 permite a realização de acesso utilizando as bibliotecas de acesso de versão 1.5.x, onde \emph{x} pode assumir qualquer valor de \emph{C\_D}.
Porém, é importante deixar claro que versão 2.0 traz muitas melhorias no quesito de segurança, e essas melhorias não serão usufruídas por clientes que acessam o barramento com versões antigas das bibliotecas de acesso.
O barramento permite que clientes 1.5 se comuniquem com clientes 2.0, e vice-e-versa, porém essas comunicações se realizam com o mesmo nível de segurança que existia na versão 1.5 do barramento.

\subsection{\openbus{} para Gerentes do Barramento}

Gerentes do 

% BUSADMIN
%- Opções
%  * Informa o endereço do Barramento (padrão 127.0.0.1):
%    --host=<endereço>
%  * Informa a porta do Barramento (padrão 2089):
%    --port=<porta>
%  * Aciona o verbose da API Openbus.
%    --verbose=<level>
%  * Aciona o verbose do OiL.
%    --oilverbose=<level>
%
%- Controle de Categoria
%  * Adicionar categoria:
%     --add-category=<id_categoria> --name=<nome>
%  * Remover categoria:
%     --del-category=<id_categoria>
%  * Alterar o nome descritivo da categoria:
%     --set-category=<id_categoria> --name=<nome>
%  * Mostrar todas as categorias:
%     --list-category
%  * Mostrar informações sobre uma categoria:
%     --list-category=<id_categoria>
%
%- Controle de Entidade
%  * Adicionar entidade:
%     --add-entity=<id_entidade> --category=<id_categoria> --name=<nome>
%  * Alterar descrição:
%     --set-entity=<id_entidade> --name=<nome>
%  * Remover entidade:
%     --del-entity=<id_entidade>
%  * Mostrar todas as entidades:
%     --list-entity
%  * Mostrar informações sobre uma entidade:
%     --list-entity=<id_entidade>
%  * Mostrar entidades de uma categoria:
%     --list-entity --category=<id_categoria>
%
%- Controle de Certificado
%  * Adiciona certificado da entidade:
%    --add-certificate=<id_entidade> --certificate=<certificado>
%  * Remover certificado da entidade:
%    --del-certificate=<id_entidade>
%     
%- Controle de Interface
%  * Adicionar interface:
%     --add-interface=<interface>
%  * Remover interface:
%     --del-interface=<interface>
%  * Mostrar todas interfaces:
%     --list-interface
%
%- Controle de Autorização
%  * Conceder autorização:
%     --set-authorization=<id_entidade> --grant=<interface>
%  * Revogar autorização:
%     --set-authorization=<id_entidade> --revoke=<interface>
%  * Mostrar todas as autorizações:
%     --list-authorization
%  * Mostrar autorizações da entidade:
%     --list-authorization=<id_entidade>
%  * Mostrar todas autorizações contendo as interfaces:
%     --list-authorization --interface="<iface1> <iface2> ... <ifaceN>"
%
%- Controle de Ofertas no Serviço de Registro
%  * Remover oferta (lista e aguarda a entrada de um índice para remover a oferta):
%    --del-offer
%  * Remover oferta da entidade (lista e aguarda a entrada de um índice para remover a oferta):
%    --del-offer --entity=<id_entidade>
%  * Mostrar todas interfaces ofertadas:
%     --list-offer
%  * Mostrar todas interfaces ofertadas por uma entidade:
%     --list-offer=<id_entidade>
%  * Mostrar as propriedades da oferta (lista e aguarda a entrada de um índice para listar propriedades da oferta):
%     --list-props
%  * Mostrar as propriedades da oferta por uma entidade (lista e aguarda a entrada de um índice para listar propriedades da oferta):
%     --list-props=<id_entidade>
%
%- Controle de Logins
%  * Remove um login:
%     --del-login=<id_login>
%  * Mostrar todos os logins:
%     --list-login
%  * Mostrar todos os logins de uma entidade:
%     --list-login --entity=<id_entidade>
%
%- Script
%  * Executa script Lua com um lote de comandos:
%     --script=<arquivo>
%  * Desfaz a execução de um script Lua com um lote de comandos:
%    --undo-script=<arquivo>
%
%- Relatório
%  * Monta um relatório sobre o estado atual do barramento:
%    --report
%

\subsection{\openbus{} para Desenvolvedores}

Como desenvolvedores, nos referimos aos responsáveis por implementar a integração de seus respectivos serviços e aplicações ao barramento.
Como informando na seção~\ref{subsec:barramento}, oferecemos uma biblioteca de acesso, que implementa o protocolo e exporta uma API de programação, que oferece alguns facilitadores e auxilia a interação com o barramento.
Para maiores informações, consulte o manual de uso da biblioteca de acesso, que é disponibilizada em C++~\cite{sdk2.0.0-cpp}, C\#~\cite{sdk2.0.0-csharp}, Java~\cite{sdk2.0.0-java} e Lua~\cite{sdk2.0.0-lua}.


\include{glossary}

\bibliographystyle{plain}
\bibliography{references}

\end{document}
